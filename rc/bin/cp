#!/bin/bash
#########################################################
# 							#
# This is BashStyle-NG					#
#							#
# Licensed under GNU GENERAL PUBLIC LICENSE v3    	#
#							#
# Copyright 2007 - 2010 Christopher Bratusek		#
#							#
#########################################################

if [[ $WANT_DIRINFO_FLAGS == "true" ]]; then

	if [[ $1 == --help || $1 == -h ]]; then
		$CP_CMD --help
		exit 0
	elif [[ ${#} -lt "2" && ${1} != *{,* ]]; then
		echo "not enough arguements"
		exit 1
	fi

	if [[ "${!#}" == */ && ! -e "${!#}" ]]; then
		mkdir -p "${!#}"
	fi

	destination="${!#}"

	args=( "$@" )
	unset args[$#-1]
	set -- "${args[@]}"

	for path in "${args[@]}"; do
	      test "${path:0:1}" == - && CPO+="$path " && continue
	      for try in "$path" "${path%/*}"; do
		  test -e "$try"/.dirinfo || continue
		  grep -q NoCopy "$try"/.dirinfo || continue
		  echo "can not delete $try, it's protected"
		  continue 2
	      done
	      if test "${path}" == "*{,*" ; then
		   $CP_CMD $CP_OPTS $CPO "$path"
	      else $CP_CMD $CP_OPTS $CPO "$path" "$destination"
	      fi
	done

	unset CPO

else	$CP_CMD "$@"
fi
